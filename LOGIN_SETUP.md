# 🔐 관리자 로그인 설정 안내

## 개요
일자리도약장려금 관리 시스템에 **관리자 전용 로그인** 기능이 추가되었습니다.
외부인의 접근을 완전히 차단하고 민감한 개인정보를 보호합니다.

---

## 📦 1단계: 패키지 설치

터미널에서 다음 명령을 실행하세요:

```bash
cd new
npm install
```

설치되는 패키지:
- `express-session`: 세션 관리
- `bcrypt`: 비밀번호 암호화

---

## 🔑 2단계: 관리자 비밀번호 설정

### 방법 1: 자동 설정 스크립트 사용 (권장) ⭐

```bash
node setup-admin-password.js
```

스크립트 실행 시:
1. 비밀번호를 입력합니다 (8자 이상)
2. 비밀번호를 다시 입력하여 확인합니다
3. 암호화된 해시값이 생성됩니다

예시:
```
===========================================
   관리자 비밀번호 설정 유틸리티
===========================================

관리자 계정의 비밀번호를 설정합니다.

비밀번호를 입력하세요 (8자 이상): ********
비밀번호를 다시 입력하세요: ********

🔐 비밀번호 암호화 중...

✅ 비밀번호가 암호화되었습니다!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📝 다음 중 하나의 방법으로 설정하세요:

방법 1: server.js 파일 수정 (추천)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
server.js 파일을 열고 다음 줄을 찾으세요:

const ADMIN_PASSWORD_HASH = process.env.ADMIN_PASSWORD_HASH || null;

아래와 같이 변경하세요:

const ADMIN_PASSWORD_HASH = process.env.ADMIN_PASSWORD_HASH || '$2b$10$abc...xyz';

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 방법 2: 직접 server.js 파일 수정

1. `new/server.js` 파일을 엽니다
2. 다음 줄을 찾습니다:
   ```javascript
   const ADMIN_PASSWORD_HASH = process.env.ADMIN_PASSWORD_HASH || null;
   ```
3. `null` 대신 암호화된 비밀번호 해시값을 넣습니다:
   ```javascript
   const ADMIN_PASSWORD_HASH = process.env.ADMIN_PASSWORD_HASH || '$2b$10$...암호화된해시값...';
   ```

---

## 🚀 3단계: 서버 실행

```bash
node server.js
```

서버가 `http://localhost:3001`에서 실행됩니다.

---

## 🔐 4단계: 로그인

1. 브라우저에서 `http://localhost:3001` 접속
2. 자동으로 로그인 페이지로 리다이렉트됩니다
3. **관리자 계정**으로 로그인:
   - **아이디**: `admin`
   - **비밀번호**: 위에서 설정한 비밀번호

### 로그인 성공 시:
- ✅ 메인 대시보드로 이동
- ✅ **모든 기업의 데이터**를 볼 수 있습니다
- ✅ 24시간 동안 로그인 상태 유지

---

## 🔑 비밀번호 변경

로그인한 상태에서 비밀번호를 변경할 수 있습니다:

### 앱 내에서 변경:
1. 사이드바 상단의 🔑 버튼 클릭
2. 현재 비밀번호 입력
3. 새 비밀번호 입력 (8자 이상)
4. 새 비밀번호 확인
5. "변경하기" 버튼 클릭
6. **콘솔에 표시되는 새 해시값을 복사**
7. `server.js` 파일에 새 해시값 업데이트
8. **서버 재시작**

---

## 🚪 로그아웃

사이드바 상단의 🚪 버튼을 클릭하면 로그아웃됩니다.

---

## 🛡️ 보안 기능

### 1. 관리자 단일 계정
- 한 명의 관리자만 로그인 가능
- 모든 기업 데이터 관리 권한

### 2. 세션 기반 인증
- 24시간 자동 로그아웃
- HttpOnly 쿠키로 XSS 공격 방어

### 3. 비밀번호 암호화
- bcrypt 알고리즘 사용
- 단방향 암호화 (복호화 불가능)

### 4. API 보호
- 모든 API 엔드포인트에 인증 필요
- 로그인하지 않으면 401 에러 반환

### 5. 자동 로그인 체크
- 페이지 로드 시 자동으로 인증 확인
- 세션 만료 시 자동으로 로그인 페이지로 이동

---

## 🎯 중요 사항

### ⚠️ 반드시 알아야 할 것들:

1. **관리자 계정은 1개만 존재합니다**
   - 기업별 계정이 아닙니다!
   - 관리자가 모든 기업의 데이터를 관리합니다

2. **초기 아이디는 `admin`으로 고정**
   - 변경하려면 `server.js`에서 `ADMIN_USERNAME` 수정

3. **비밀번호 변경 시 서버 재시작 필요**
   - 비밀번호 해시값을 `server.js`에 직접 입력해야 함
   - 환경변수(`.env`)를 사용하면 재시작만으로 적용 가능

---

## 🔧 문제 해결

### Q: 로그인이 안 됩니다
**A:** 다음을 확인하세요:
1. `setup-admin-password.js`를 실행했는지 확인
2. `server.js`에 해시값이 올바르게 입력되었는지 확인
3. 서버를 재시작했는지 확인
4. 아이디가 `admin`인지 확인

### Q: "비밀번호가 설정되지 않았습니다" 오류
**A:** `setup-admin-password.js`를 실행하고 `server.js`를 수정하세요.

### Q: 비밀번호를 잊어버렸습니다
**A:** `setup-admin-password.js`를 다시 실행하여 새 비밀번호를 설정하세요.

### Q: 로그인 후 다시 로그인 페이지로 이동합니다
**A:** 브라우저 쿠키가 활성화되어 있는지 확인하세요.

---

## 🚀 프로덕션 배포 시 권장사항

### 1. 환경변수 사용

`.env` 파일 생성:
```env
ADMIN_USERNAME=admin
ADMIN_PASSWORD_HASH=$2b$10$...해시값...
SESSION_SECRET=매우-긴-무작위-문자열
```

`server.js` 상단에 추가:
```javascript
require('dotenv').config();
```

### 2. HTTPS 사용

```javascript
// server.js에서 수정
cookie: {
    secure: true, // HTTPS 필수
    httpOnly: true,
    maxAge: 24 * 60 * 60 * 1000
}
```

### 3. 아이디 변경

기본 `admin`은 쉽게 추측 가능하므로 변경 권장:
```javascript
const ADMIN_USERNAME = process.env.ADMIN_USERNAME || 'your_unique_admin_id';
```

---

## ✅ 설정 완료 체크리스트

- [ ] npm install 실행 완료
- [ ] `setup-admin-password.js` 실행 완료
- [ ] `server.js`에 해시값 입력 완료
- [ ] 서버 실행 확인
- [ ] 로그인 테스트 성공 (`admin` + 설정한 비밀번호)
- [ ] 모든 기업 데이터 접근 가능 확인
- [ ] 로그아웃 테스트 성공
- [ ] 비밀번호 변경 테스트 성공

---

## 🎉 완료!

이제 시스템이 안전하게 보호됩니다!

**로그인 정보:**
- 아이디: `admin`
- 비밀번호: (본인이 설정한 비밀번호)
- 접속 주소: `http://localhost:3001`

**중요:** 비밀번호를 안전한 곳에 보관하세요! 🔒
